# –ú–∏–≥—Ä–∞—Ü–∏—è —Å NextAuth –Ω–∞ Better Auth

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Better Auth** –∏ —É–¥–∞–ª–µ–Ω NextAuth
2. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ Prisma —Å—Ö–µ–º–∞** - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–±–ª–∏—Ü—ã Better Auth (user, session, account, verification)
3. **–°–æ–∑–¥–∞–Ω API route** `/api/auth/[...all]/route.ts`
4. **–°–æ–∑–¥–∞–Ω auth-client** –≤ `lib/auth-client.ts`
5. **–û–±–Ω–æ–≤–ª–µ–Ω middleware** —Å server-side –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å–µ—Å—Å–∏–∏
6. **–û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Better Auth
7. **–£–¥–∞–ª–µ–Ω—ã —Ñ–∞–π–ª—ã NextAuth**

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```bash
BETTER_AUTH_SECRET="your-secret-key-min-32-chars"
BETTER_AUTH_URL="http://localhost:3000"
NEXT_PUBLIC_APP_URL="http://localhost:3000"  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç:
```bash
openssl rand -base64 32
```

## üìä –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–æ–≤—É—é —Å—Ö–µ–º—É Prisma:**
```bash
npx prisma db push
```

2. **–ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   - Better Auth —Ö—Ä–∞–Ω–∏—Ç –ø–∞—Ä–æ–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `account` (–ø–æ–ª–µ `password`)
   - –°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `User` –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –Ω–æ–≤—É—é —Å—Ö–µ–º—É
   - –ò–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ —á–µ—Ä–µ–∑ `/register`

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ seed (—Å–æ–∑–¥–∞—Å—Ç admin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):**
```bash
npm run db:seed
```

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞
- `useSession()` –∏–∑ `next-auth/react` ‚Üí `useSessionWithPermissions()` –∏–∑ `@/lib/use-session`
- `signIn()` ‚Üí `authClient.signIn.email()`
- `signOut()` ‚Üí `authClient.signOut()`

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞
- `auth()` –∏–∑ NextAuth ‚Üí `getSessionWithPermissions(headers)` –∏–∑ `@/lib/auth`
- –°–µ—Å—Å–∏—è —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç `permissions` –Ω–∞ –æ—Å–Ω–æ–≤–µ `user.role`

### API Routes
- –í—Å–µ API routes –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `getSessionWithPermissions()`
- Middleware –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `auth.api.getSession()` —Å Node.js runtime

## üöÄ –ó–∞–ø—É—Å–∫

```bash
npm install
npm run dev
```

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–∞—Ä–æ–ª–∏:** Better Auth –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π —Ñ–æ—Ä–º–∞—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–æ–ª–∏ –∏–∑ NextAuth –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ.

2. **–†–æ–ª–∏:** –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–æ–ª–µ `role` —Ç–∞–±–ª–∏—Ü—ã `user` (–¥–æ–±–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ `additionalFields`)

3. **–°–µ—Å—Å–∏–∏:** Better Auth –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É `session` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π

4. **Middleware:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Node.js runtime –¥–ª—è –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É "You are using the default secret":
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `BETTER_AUTH_SECRET` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ú–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã `user` –∏ `account` —Å–æ–∑–¥–∞–Ω—ã
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
